import{j as e}from"./jsx-runtime-BeARgc9F.js";import"./sccHouseFlow__mf_v__runtimeInit__mf_v__-BLPqLc-p.js";const G="M 499 798 L 498 758 L 452 702 L 553 678 L 652 657 L 743 635",z="M 743 635 L 652 657 L 553 678 L 452 702 L 498 758 L 499 798",A="M 463 815 L 425 825 L 380 812 L 379 838",S="M 546 818 L 829 746 L 831 776 L 832 984",H="M 546 845 L 657 815 L 657 869";function f(s){if(s==null||isNaN(s))return"–";const t=Number(s);return t>=1e3?(t/1e3).toFixed(2)+" kW":Math.round(t)+" W"}function R(s){if(s==null)return null;if(typeof s=="string")try{return JSON.parse(s)}catch{return null}return s}const O=window.visRxWidget;class P extends O{static adapter="scc";constructor(t){super(t)}static getWidgetInfo(){return{id:"sccHouseFlow",visSet:"scc",visSetIcon:"",visSetLabel:"scc_House_Flow",visSetColor:"#4caf50",visName:"SccHouseFlowWidget",visAttrs:[{name:"private",label:"private",fields:[{name:"oid",type:"id",label:"scc_flowData_oid"}]}],visPrev:""}}getWidgetInfo(){return P.getWidgetInfo()}static getI18nPrefix(){return"scc_"}renderWidgetBody(t){var n,g;const o=this.state,r=(n=o.rxData)==null?void 0:n.oid,d=r?(g=o.values)==null?void 0:g[`${r}.val`]:void 0,i=R(d);return e.jsx(V,{data:i})}}function V({data:s}){var y,N,k,L,W,C,M,$;const t=((y=s==null?void 0:s.generation)==null?void 0:y.totalW)!=null?Number(s.generation.totalW):0,o=((N=s==null?void 0:s.grid)==null?void 0:N.consumptionW)!=null?Number(s.grid.consumptionW):0,r=((k=s==null?void 0:s.grid)==null?void 0:k.feedInW)!=null?Number(s.grid.feedInW):0,d=((L=s==null?void 0:s.consumption)==null?void 0:L.totalW)!=null?Number(s.consumption.totalW):0,i=((W=s==null?void 0:s.batteries)==null?void 0:W.totalChargeW)!=null?Number(s.batteries.totalChargeW):0,n=((C=s==null?void 0:s.batteries)==null?void 0:C.totalDischargeW)!=null?Number(s.batteries.totalDischargeW):0,g=((M=s==null?void 0:s.batteries)==null?void 0:M.items)??{},x=(($=Object.values(g)[0])==null?void 0:$.soc)??null,_=x!=null?Math.round(x)+"%":"–",F=i>0?"lädt":n>0?"entlädt":"wartet";function I(c){return c==="battery"?n>0&&i<=0?"scc-house-line--dir-rev":"scc-house-line--dir-fwd":c==="grid"?r>0?"scc-house-line--dir-fwd":"scc-house-line--dir-rev":"scc-house-line--dir-fwd"}function D(c){return c==="pv"||c==="battery"?"scc-house-line--green":c==="grid"?r>0?"scc-house-line--green":"scc-house-line--red":c==="house"?o>0&&t>0?"scc-house-line--mixed":o>0?"scc-house-line--red":"scc-house-line--green":"scc-house-line--green"}function m(c,a){let h=`scc-house-line scc-house-line--${a} ${I(a)} ${D(a)}`;return c&&(h+=" scc-house-line--active"),h}function p(c){return`scc-house-line-base scc-house-line-base--${c}`}function u(c){return c==="pv"?t>0?"scc-house-value--green":"scc-house-value--muted":c==="house"?d<=0?"scc-house-value--muted":o>0&&t>0?"scc-house-value--mixed":o>0?"scc-house-value--red":"scc-house-value--green":c==="battery"?i>0?"scc-house-value--green":n>0?"scc-house-value--red":"scc-house-value--muted":c==="grid"?r>0?"scc-house-value--green":o>0?"scc-house-value--red":"scc-house-value--muted":"scc-house-value--muted"}const v=x!=null?Math.min(100,Math.max(0,Number(x))):0,w=i>0,j=n>0,T=w?"#00c853":j?"#c62828":"rgba(255,255,255,0.25)",B="rgba(255,255,255,0.08)",E=[0,1,2,3,4].map(c=>{const a=(c+1)*20,h=v>=a,b=Math.max(-1,Math.min(4,Math.floor(v/20)-1));return{i:c,filled:h,charging:(w||j)&&c===b}}),l="scc-house-flow-"+Math.random().toString(36).slice(2,9);return e.jsxs("div",{className:"scc-house-widget",style:{width:"100%",height:"100%",minHeight:200},children:[e.jsx("style",{children:`
        .scc-house-widget { --scc-bg: #1a1a1e; --scc-text: #e0e0e0; --scc-muted: #9e9e9e; --scc-heading: #fff; }
        .scc-house-widget .scc-house-wrap { position: relative; width: 100%; max-width: 100%; margin: 0; aspect-ratio: 1024/1536; background: var(--scc-bg); border-radius: 12px; overflow: hidden; }
        .scc-house-widget .scc-house-svg { position: absolute; left:0; top:0; width:100%; height:100%; pointer-events: none; }
        .scc-house-widget .scc-house-lines .scc-house-line-base { stroke: rgba(0,0,0,0.85); stroke-width: 5; stroke-linecap: round; }
        .scc-house-widget .scc-house-lines .scc-house-line { stroke-width: 6; stroke-linecap: round; stroke: rgba(0,0,0,0); }
        .scc-house-widget .scc-house-lines .scc-house-line--active { stroke-width: 7; filter: url(#${l}-glow); }
        .scc-house-widget .scc-house-lines .scc-house-line--active.scc-house-line--green { stroke: url(#${l}-green); }
        .scc-house-widget .scc-house-lines .scc-house-line--active.scc-house-line--red { stroke: url(#${l}-red); }
        .scc-house-widget .scc-house-lines .scc-house-line--active.scc-house-line--mixed { stroke: url(#${l}-mixed); }
        .scc-house-widget .scc-house-lines .scc-house-line--active { stroke-dasharray: 6 22; animation: scc-dash .9s linear infinite; }
        .scc-house-widget .scc-house-lines .scc-house-line--active.scc-house-line--dir-rev { animation-direction: reverse; }
        @keyframes scc-dash { from { stroke-dashoffset: 0; } to { stroke-dashoffset: -28; } }
        .scc-house-widget .scc-house-connectors .scc-house-conn { fill: none; stroke: rgba(255,255,255,0.35); stroke-width: 1.8; stroke-dasharray: 6 10; }
        .scc-house-widget .scc-house-battery-display .scc-battery-seg { transition: fill .35s ease; }
        .scc-house-widget .scc-house-battery-display .scc-battery-seg--charging { animation: scc-pulse 1.2s ease-in-out infinite; }
        @keyframes scc-pulse { 0%,100%{opacity:1} 50%{opacity:.55} }
        .scc-house-widget .scc-house-value { font-size: 42px; font-weight: 700; fill: var(--scc-heading); paint-order: stroke; stroke: rgba(0,0,0,.8); stroke-width: 5px; }
        .scc-house-widget .scc-house-label { font-size: 20px; fill: var(--scc-muted); text-transform: uppercase; paint-order: stroke; stroke: rgba(0,0,0,.65); stroke-width: 3px; }
        .scc-house-widget .scc-house-sublabel { font-size: 18px; fill: var(--scc-muted); text-transform: uppercase; paint-order: stroke; stroke: rgba(0,0,0,.55); stroke-width: 2.5px; }
        .scc-house-widget .scc-house-value--green { fill: #5aff78 !important; }
        .scc-house-widget .scc-house-value--red { fill: #ff6b6b !important; }
        .scc-house-widget .scc-house-value--mixed { fill: #81c784; }
        .scc-house-widget .scc-house-value--muted { fill: var(--scc-muted) !important; }
      `}),e.jsx("div",{className:"scc-house-wrap",children:e.jsxs("svg",{className:"scc-house-svg",viewBox:"0 0 1024 1536",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid meet",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`${l}-green`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#00c853"}),e.jsx("stop",{offset:"35%",stopColor:"#69f0ae"}),e.jsx("stop",{offset:"65%",stopColor:"#69f0ae"}),e.jsx("stop",{offset:"100%",stopColor:"#00c853"})]}),e.jsxs("linearGradient",{id:`${l}-red`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#b71c1c"}),e.jsx("stop",{offset:"35%",stopColor:"#ff6b6b"}),e.jsx("stop",{offset:"65%",stopColor:"#ff6b6b"}),e.jsx("stop",{offset:"100%",stopColor:"#b71c1c"})]}),e.jsxs("linearGradient",{id:`${l}-mixed`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#5aff78"}),e.jsx("stop",{offset:"50%",stopColor:"#5aff78"}),e.jsx("stop",{offset:"50%",stopColor:"#ff6b6b"}),e.jsx("stop",{offset:"100%",stopColor:"#ff6b6b"})]}),e.jsxs("filter",{id:`${l}-glow`,x:"-40%",y:"-40%",width:"180%",height:"180%",children:[e.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsxs("g",{className:"scc-house-connectors",children:[e.jsx("path",{d:"M 521 200 L 521 574",className:"scc-house-conn"}),e.jsx("path",{d:"M 379 140 L 379 838",className:"scc-house-conn"}),e.jsx("path",{d:"M 669 1330 L 669 942",className:"scc-house-conn"}),e.jsx("path",{d:"M 857 1330 L 857 810",className:"scc-house-conn"})]}),e.jsxs("g",{className:"scc-house-lines",children:[e.jsx("path",{d:G,className:p("pv"),fill:"none"}),e.jsx("path",{d:A,className:p("house"),fill:"none"}),e.jsx("path",{d:S,className:p("grid"),fill:"none"}),e.jsx("path",{d:H,className:p("battery"),fill:"none"}),e.jsx("path",{d:z,className:m(t>0,"pv"),fill:"none",pathLength:100}),e.jsx("path",{d:A,className:m(d>0,"house"),fill:"none",pathLength:100}),e.jsx("path",{d:S,className:m(o>0||r>0,"grid"),fill:"none",pathLength:100}),e.jsx("path",{d:H,className:m(i>0||n>0,"battery"),fill:"none",pathLength:100})]}),e.jsx("g",{className:"scc-house-battery-display",transform:"matrix(1.1875,-0.3542,0,0.9872,640.25,912.55)",children:[74,58,42,26,10].map((c,a)=>{const{filled:h,charging:b}=E[a];return e.jsx("rect",{className:`scc-battery-seg ${b?"scc-battery-seg--charging":""}`,x:4,y:c,width:48,height:14,rx:5,ry:5,fill:h?T:B},a)})}),e.jsxs("g",{className:"scc-house-labels",children:[e.jsxs("g",{className:"scc-house-label-block scc-house-label-top",transform:"translate(521, 200)",children:[e.jsx("text",{"data-scc":"val-pv",className:`scc-house-value ${u("pv")}`,y:0,textAnchor:"middle",children:f(t)}),e.jsx("text",{className:"scc-house-label",y:50,textAnchor:"middle",children:"Photovoltaik"})]}),e.jsxs("g",{className:"scc-house-label-block scc-house-label-top",transform:"translate(379, 140)",children:[e.jsx("text",{"data-scc":"val-house",className:`scc-house-value ${u("house")}`,y:0,textAnchor:"middle",children:f(d)}),e.jsx("text",{className:"scc-house-label",y:50,textAnchor:"middle",children:"Last"})]}),e.jsxs("g",{className:"scc-house-label-block scc-house-label-bottom",transform:"translate(669, 1330)",children:[e.jsx("text",{"data-scc":"val-battery",className:`scc-house-value ${u("battery")}`,y:0,textAnchor:"middle",children:f(i>0?i:n)}),e.jsxs("text",{"data-scc":"lab-battery",className:`scc-house-label ${u("battery")}`,y:50,textAnchor:"middle",children:["Batterie ",_," ",F]})]}),e.jsxs("g",{className:"scc-house-label-block scc-house-label-bottom",transform:"translate(857, 1330)",children:[e.jsx("text",{"data-scc":"val-grid",className:`scc-house-value ${u("grid")}`,y:0,textAnchor:"middle",children:o>0?f(o):r>0?f(r):"–"}),e.jsx("text",{"data-scc":"sub-grid",className:`scc-house-sublabel ${u("grid")}`,y:48,textAnchor:"middle",children:o>0?"Bezug":r>0?"Einspeisung":""}),e.jsx("text",{className:"scc-house-label",y:72,textAnchor:"middle",children:"Netz"})]})]})]})})]})}export{P as default};
